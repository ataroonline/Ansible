- name: Join Windows to Active Directory
  hosts: windows
  gather_facts: no

  tasks:
    - name: Join domain
      microsoft.ad.membership:
        dns_domain_name: entreprise.local
        domain_admin_user: admin@entreprise.local
        domain_admin_password: MotDePasseDomaine
        state: domain
      register: domain_join

    - name: Reboot if required
      ansible.windows.win_reboot:
      when: domain_join.reboot_required
